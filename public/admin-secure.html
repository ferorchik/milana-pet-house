<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Milana Pet HOUSE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .drag-over {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }
    
    .preview-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }
    
    .preview-item {
      position: relative;
      aspect-ratio: 1;
      overflow: hidden;
      border-radius: 0.5rem;
    }
    
    .preview-item img,
    .preview-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .upload-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(0,0,0,0.2);
    }
    
    .upload-progress-bar {
      height: 100%;
      background: #3b82f6;
      transition: width 0.3s;
    }
    
    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notificationContainer"></div>
  
  <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
  <div id="loginForm" class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full">
      <h1 class="text-2xl font-bold text-center mb-6">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
      <form onsubmit="return false;">
        <input type="email" id="email" placeholder="Email" value="feror2013@gmail.com" required
               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4">
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required
               class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <button onclick="login()" type="button"
                class="w-full mt-4 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
          –í–æ–π—Ç–∏
        </button>
      </form>
      <p id="errorMsg" class="text-red-500 text-sm mt-3 text-center hidden"></p>
    </div>
  </div>
  
  <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
  <div id="adminPanel" class="hidden">
    <!-- –®–∞–ø–∫–∞ -->
    <header class="bg-white shadow-sm border-b">
      <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-800">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Milana Pet HOUSE</h1>
        <div class="flex items-center space-x-4">
          <span id="userEmail" class="text-gray-600"></span>
          <button onclick="logout()" class="text-gray-600 hover:text-gray-800">–í—ã–π—Ç–∏</button>
        </div>
      </div>
    </header>
    
    <div class="max-w-7xl mx-auto p-4">
      <!-- –¢–∞–±—ã -->
      <div class="bg-white rounded-lg shadow mb-6">
        <div class="border-b flex">
          <button onclick="showTab('add')" id="tabAdd" 
                  class="px-6 py-3 font-semibold text-blue-600 border-b-2 border-blue-600">
            –î–æ–±–∞–≤–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞
          </button>
          <button onclick="showTab('list')" id="tabList"
                  class="px-6 py-3 font-semibold text-gray-600 hover:text-gray-800">
            –í—Å–µ –ø–∏—Ç–æ–º—Ü—ã
          </button>
          <button onclick="showTab('stats')" id="tabStats"
                  class="px-6 py-3 font-semibold text-gray-600 hover:text-gray-800">
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
          </button>
          <button onclick="showTab('callbacks')" id="tabCallbacks"
                  class="px-6 py-3 font-semibold text-gray-600 hover:text-gray-800">
            –ó–∞—è–≤–∫–∏
          </button>
        </div>
      </div>
      
      <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
      <div id="addTab" class="bg-white rounded-lg shadow p-6">
        <h2 id="formTitle" class="text-xl font-bold mb-6">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞</h2>
        
        <form id="petForm" onsubmit="savePet(event)">
          <input type="hidden" id="editingPetId" value="">
          
          <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ -->
          <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              –§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ (–¥–æ 10 —Ñ–∞–π–ª–æ–≤)
            </label>
            <div id="dropZone" 
                 class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-400 transition"
                 ondrop="handleDrop(event)" 
                 ondragover="handleDragOver(event)"
                 ondragleave="handleDragLeave(event)">
              <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
              <p class="text-gray-600 mb-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
              <p class="text-sm text-gray-500">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, MP4 (—Ñ–æ—Ç–æ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)</p>
              <input type="file" id="fileInput" multiple accept="image/*,video/*" 
                     class="hidden" onchange="handleFileSelect(event)">
            </div>
            
            <!-- –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ -->
            <div id="mediaPreview" class="preview-container mt-4"></div>
          </div>
          
          <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="grid md:grid-cols-2 gap-4 mb-6">
            <!-- –ò–º—è –ø–∏—Ç–æ–º—Ü–∞ (–Ω–æ–≤–æ–µ) -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–ò–º—è –ø–∏—Ç–æ–º—Ü–∞</label>
              <input type="text" id="petName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ß–∞—Ä–ª–∏" 
                     class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–¢–∏–ø –∂–∏–≤–æ—Ç–Ω–æ–≥–æ</label>
              <select id="petType" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                <option value="dog">–°–æ–±–∞–∫–∞</option>
                <option value="cat">–ö–æ—à–∫–∞</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–ü–æ—Ä–æ–¥–∞</label>
              <select id="breed" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä–æ–¥—É</option>
                <option value="Poodle">Poodle (–ü—É–¥–µ–ª—å)</option>
                <option value="Maltipoo">Maltipoo (–ú–∞–ª—å—Ç–∏–ø—É)</option>
                <option value="Yorkshire Terrier">Yorkshire Terrier (–ô–æ—Ä–∫—à–∏—Ä—Å–∫–∏–π —Ç–µ—Ä—å–µ—Ä)</option>
                <option value="Maltese">Maltese (–ú–∞–ª—å—Ç–µ–∑–µ)</option>
                <option value="Toy Poodle">Toy Poodle (–¢–æ–π-–ø—É–¥–µ–ª—å)</option>
                <option value="Bichon Frise">Bichon Frise (–ë–∏—à–æ–Ω —Ñ—Ä–∏–∑–µ)</option>
                <option value="Other">–î—Ä—É–≥–∞—è –ø–æ—Ä–æ–¥–∞</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–ü–æ–ª</label>
              <select id="gender" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                <option value="male">–ú–∞–ª—å—á–∏–∫</option>
                <option value="female">–î–µ–≤–æ—á–∫–∞</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–í–æ–∑—Ä–∞—Å—Ç (–º–µ—Å—è—Ü–µ–≤)</label>
              <input type="number" id="age" min="1" max="120" placeholder="3" 
                     class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–¶–µ–Ω–∞ (‚Ç¥)</label>
              <input type="number" id="price" min="0" step="100" placeholder="10000" 
                     class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–°—Ç–∞—Ç—É—Å</label>
              <select id="status" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="available">–î–æ—Å—Ç—É–ø–µ–Ω</option>
                <option value="reserved">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω</option>
                <option value="sold">–ü—Ä–æ–¥–∞–Ω</option>
              </select>
            </div>
          </div>
          
          <!-- –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–æ–≤–æ–µ) -->
          <div class="mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="description" rows="4" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–µ, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö –ø–∏—Ç–æ–º—Ü–∞..."
                      class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
          </div>
          
          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="grid md:grid-cols-2 gap-4 mb-6">
            <!-- –ü—Ä–∏–≤–∏–≤–∫–∏ (–Ω–æ–≤–æ–µ) -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–ü—Ä–∏–≤–∏–≤–∫–∏</label>
              <textarea id="vaccinations" rows="3" placeholder="–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≤–∏–≤–æ–∫ –∏ –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–∞–∫—Ü–∏–Ω–∞—Ü–∏–∏"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
            
            <!-- –†–æ–¥–∏—Ç–µ–ª–∏ (–Ω–æ–≤–æ–µ) -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–¥–∏—Ç–µ–ª—è—Ö</label>
              <textarea id="parents" rows="3" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–º–µ –∏ –ø–∞–ø–µ"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
          </div>
          
          <!-- –ö–Ω–æ–ø–∫–∏ -->
          <div class="flex gap-4">
            <button type="submit" id="submitBtn"
                    class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
              –î–æ–±–∞–≤–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞
            </button>
            <button type="button" onclick="cancelEdit()" id="cancelBtn" class="hidden px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition font-semibold">
              –û—Ç–º–µ–Ω–∞
            </button>
          </div>
        </form>
      </div>
      
      <!-- –°–ø–∏—Å–æ–∫ –ø–∏—Ç–æ–º—Ü–µ–≤ -->
      <div id="listTab" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-bold mb-6">–í—Å–µ –ø–∏—Ç–æ–º—Ü—ã</h2>
          <div id="petsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–∏—Ç–æ–º—Ü–µ–≤ -->
          </div>
        </div>
      </div>
      
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div id="statsTab" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-bold mb-6">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</h2>
          <div id="statsContent" class="space-y-4">
            <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
          </div>
        </div>
      </div>
      
      <!-- –ó–∞—è–≤–∫–∏ –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫ -->
      <div id="callbacksTab" class="hidden">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-bold mb-6">–ó–∞—è–≤–∫–∏ –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫</h2>
          <div id="callbacksContent" class="space-y-4">
            <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –∑–∞—è–≤–∫–∏ -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å Authentication -->
  <script type="module">
    // –ò–º–ø–æ—Ä—Ç Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getDatabase, ref, push, set, get, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
    
    // –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAKcZ78l0bDpTweaM5aPDUV0HU97UAcYFk",
      authDomain: "mph-com-ua.firebaseapp.com",
      databaseURL: "https://mph-com-ua-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "mph-com-ua",
      storageBucket: "mph-com-ua.firebasestorage.app",
      messagingSenderId: "165948585505",
      appId: "1:165948585505:web:3508790f07d1082a17a93a",
      measurementId: "G-TVD7CXRCFP"
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const storage = getStorage(app);
    
    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
    window.auth = auth;
    window.signInWithEmailAndPassword = signInWithEmailAndPassword;
    window.signOut = signOut;
    window.database = database;
    window.storage = storage;
    window.storageRef = storageRef;
    window.uploadBytes = uploadBytes;
    window.getDownloadURL = getDownloadURL;
    window.deleteObject = deleteObject;
    window.dbRef = ref;
    window.dbPush = push;
    window.dbSet = set;
    window.dbGet = get;
    window.dbUpdate = update;
    window.dbOnValue = onValue;
    window.dbRemove = remove;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        document.getElementById('userEmail').textContent = user.email;
        window.loadPets();
      } else {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('adminPanel').classList.add('hidden');
      }
    });
  </script>
  
  <script>
    let uploadedFiles = [];
    let existingMedia = [];
    let currentEditingId = null;
    
    // –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const errorMsg = document.getElementById('errorMsg');
      
      try {
        await window.signInWithEmailAndPassword(window.auth, email, password);
        errorMsg.classList.add('hidden');
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
        errorMsg.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
        errorMsg.classList.remove('hidden');
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
    async function logout() {
      try {
        await window.signOut(window.auth);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
      }
    }
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(message, type = 'success') {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification bg-${type === 'success' ? 'green' : 'red'}-500 text-white px-6 py-4 rounded-lg shadow-lg`;
      notification.textContent = message;
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
    function showTab(tab) {
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
      document.getElementById('addTab').classList.add('hidden');
      document.getElementById('listTab').classList.add('hidden');
      document.getElementById('statsTab').classList.add('hidden');
      document.getElementById('callbacksTab').classList.add('hidden');
      
      // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
      document.getElementById('tabAdd').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      document.getElementById('tabList').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      document.getElementById('tabStats').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      document.getElementById('tabCallbacks').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
      document.getElementById('tabAdd').classList.add('text-gray-600');
      document.getElementById('tabList').classList.add('text-gray-600');
      document.getElementById('tabStats').classList.add('text-gray-600');
      document.getElementById('tabCallbacks').classList.add('text-gray-600');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
      if (tab === 'add') {
        document.getElementById('addTab').classList.remove('hidden');
        document.getElementById('tabAdd').classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        document.getElementById('tabAdd').classList.remove('text-gray-600');
      } else if (tab === 'list') {
        document.getElementById('listTab').classList.remove('hidden');
        document.getElementById('tabList').classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        document.getElementById('tabList').classList.remove('text-gray-600');
        loadPets();
      } else if (tab === 'stats') {
        document.getElementById('statsTab').classList.remove('hidden');
        document.getElementById('tabStats').classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        document.getElementById('tabStats').classList.remove('text-gray-600');
        loadStats();
      } else if (tab === 'callbacks') {
        document.getElementById('callbacksTab').classList.remove('hidden');
        document.getElementById('tabCallbacks').classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
        document.getElementById('tabCallbacks').classList.remove('text-gray-600');
        loadCallbacks();
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
    document.getElementById('dropZone').onclick = () => document.getElementById('fileInput').click();
    
    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('drag-over');
    }
    
    function handleDragLeave(e) {
      e.currentTarget.classList.remove('drag-over');
    }
    
    function handleDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');
      handleFiles(e.dataTransfer.files);
    }
    
    function handleFileSelect(e) {
      handleFiles(e.target.files);
    }
    
    // –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    async function compressImage(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
            const maxWidth = 1200;
            const maxHeight = 1200;
            let width = img.width;
            let height = img.height;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã
            if (width > height) {
              if (width > maxWidth) {
                height *= maxWidth / width;
                width = maxWidth;
              }
            } else {
              if (height > maxHeight) {
                width *= maxHeight / height;
                height = maxHeight;
              }
            }
            
            canvas.width = width;
            canvas.height = height;
            
            // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            ctx.drawImage(img, 0, 0, width, height);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ blob
            canvas.toBlob((blob) => {
              resolve(new File([blob], file.name, {
                type: 'image/jpeg',
                lastModified: Date.now()
              }));
            }, 'image/jpeg', 0.85); // –ö–∞—á–µ—Å—Ç–≤–æ 85%
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }
    
    async function handleFiles(files) {
      const maxFiles = 10;
      
      if (uploadedFiles.length + existingMedia.length + files.length > maxFiles) {
        alert(`–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–∫—Å–∏–º—É–º ${maxFiles} —Ñ–∞–π–ª–æ–≤`);
        return;
      }
      
      for (let file of Array.from(files)) {
        if (!file.type.match(/^(image|video)\//)) {
          alert(`–§–∞–π–ª ${file.name} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏–ª–∏ –≤–∏–¥–µ–æ`);
          continue;
        }
        
        // –°–∂–∏–º–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (file.type.startsWith('image/')) {
          showNotification('–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...', 'info');
          file = await compressImage(file);
        }
        
        uploadedFiles.push(file);
        displayPreview(file, uploadedFiles.length - 1, true);
      }
    }
    
    function displayPreview(file, index, isNew = true) {
      const preview = document.getElementById('mediaPreview');
      
      const div = document.createElement('div');
      div.className = 'preview-item relative';
      div.dataset.index = index;
      div.dataset.isNew = isNew;
      
      if (isNew && file.type) {
        // –ù–æ–≤—ã–π —Ñ–∞–π–ª
        const reader = new FileReader();
        reader.onload = (e) => {
          if (file.type.startsWith('image/')) {
            div.innerHTML = `
              <img src="${e.target.result}" alt="Preview">
              <button onclick="removeFile(${index}, ${isNew})" 
                      class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600">
                ‚úï
              </button>
              <div class="upload-progress hidden">
                <div class="upload-progress-bar" style="width: 0%"></div>
              </div>
            `;
          } else {
            div.innerHTML = `
              <video src="${e.target.result}" controls></video>
              <button onclick="removeFile(${index}, ${isNew})" 
                      class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600">
                ‚úï
              </button>
              <div class="upload-progress hidden">
                <div class="upload-progress-bar" style="width: 0%"></div>
              </div>
            `;
          }
          preview.appendChild(div);
        };
        reader.readAsDataURL(file);
      } else {
        // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –∏–∑ –±–∞–∑—ã
        const mediaType = file.type === 'video' ? 'video' : 'image';
        if (mediaType === 'image') {
          div.innerHTML = `
            <img src="${file.url}" alt="Preview">
            <button onclick="removeFile(${index}, ${isNew})" 
                    class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600">
              ‚úï
            </button>
          `;
        } else {
          div.innerHTML = `
            <video src="${file.url}" controls></video>
            <button onclick="removeFile(${index}, ${isNew})" 
                    class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600">
              ‚úï
            </button>
          `;
        }
        preview.appendChild(div);
      }
    }
    
    function removeFile(index, isNew) {
      if (isNew) {
        uploadedFiles.splice(index, 1);
      } else {
        existingMedia.splice(index, 1);
      }
      updatePreview();
    }
    
    function updatePreview() {
      const preview = document.getElementById('mediaPreview');
      preview.innerHTML = '';
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ–¥–∏–∞
      existingMedia.forEach((media, index) => {
        displayPreview(media, index, false);
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
      uploadedFiles.forEach((file, index) => {
        displayPreview(file, index, true);
      });
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
    async function savePet(e) {
      e.preventDefault();
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      if (!window.auth.currentUser) {
        alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è');
        return;
      }
      
      const editingId = document.getElementById('editingPetId').value;
      const isEditing = !!editingId;
      
      if (!isEditing && uploadedFiles.length === 0 && existingMedia.length === 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ');
        return;
      }
      
      const petData = {
        name: document.getElementById('petName').value || '',
        type: document.getElementById('petType').value,
        breed: document.getElementById('breed').value,
        gender: document.getElementById('gender').value,
        age: parseInt(document.getElementById('age').value),
        price: parseInt(document.getElementById('price').value),
        status: document.getElementById('status').value,
        description: document.getElementById('description').value || '',
        vaccinations: document.getElementById('vaccinations').value || '',
        parents: document.getElementById('parents').value || '',
        updatedAt: Date.now(),
        updatedBy: window.auth.currentUser.email,
        media: [...existingMedia]
      };
      
      if (!isEditing) {
        petData.createdAt = Date.now();
        petData.createdBy = window.auth.currentUser.email;
        petData.views = 0;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      const submitBtn = document.getElementById('submitBtn');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
      submitBtn.disabled = true;
      
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ Firebase Storage
        for (let i = 0; i < uploadedFiles.length; i++) {
          const file = uploadedFiles[i];
          const fileName = `pets/${Date.now()}_${i}_${file.name}`;
          const fileRef = window.storageRef(window.storage, fileName);
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
          const progressElements = document.querySelectorAll('.preview-item[data-is-new="true"] .upload-progress');
          if (progressElements[i]) {
            progressElements[i].classList.remove('hidden');
          }
          
          const snapshot = await window.uploadBytes(fileRef, file);
          const downloadURL = await window.getDownloadURL(snapshot.ref);
          
          petData.media.push({
            url: downloadURL,
            type: file.type.startsWith('video/') ? 'video' : 'image'
          });
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
          if (progressElements[i]) {
            progressElements[i].querySelector('.upload-progress-bar').style.width = '100%';
          }
          
          submitBtn.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤... ${i + 1}/${uploadedFiles.length}`;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É
        if (isEditing) {
          const petRef = window.dbRef(window.database, `pets/${editingId}`);
          await window.dbUpdate(petRef, petData);
          showNotification('–ü–∏—Ç–æ–º–µ—Ü —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
        } else {
          const petsRef = window.dbRef(window.database, 'pets');
          await window.dbPush(petsRef, petData);
          showNotification('–ü–∏—Ç–æ–º–µ—Ü —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
        }
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
        cancelEdit();
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
        showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error.message, 'error');
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–∏—Ç–æ–º—Ü–µ–≤
    window.loadPets = function() {
      const petsRef = window.dbRef(window.database, 'pets');
      window.dbOnValue(petsRef, (snapshot) => {
        const petsList = document.getElementById('petsList');
        petsList.innerHTML = '';
        
        const pets = snapshot.val();
        if (!pets) {
          petsList.innerHTML = '<p class="text-gray-500 text-center col-span-full">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Ç–æ–º—Ü–µ–≤</p>';
          return;
        }
        
        Object.entries(pets).forEach(([id, pet]) => {
          const card = createPetCard(id, pet);
          petsList.appendChild(card);
        });
      });
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–∏—Ç–æ–º—Ü–∞
    function createPetCard(id, pet) {
      const div = document.createElement('div');
      div.className = 'bg-gray-50 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition';
      
      const mainMedia = pet.media && pet.media[0] ? pet.media[0] : null;
      const mediaHtml = mainMedia 
        ? mainMedia.type === 'video' 
          ? `<video src="${mainMedia.url}" class="w-full h-48 object-cover" controls></video>`
          : `<img src="${mainMedia.url}" alt="${pet.breed}" class="w-full h-48 object-cover">`
        : '<div class="w-full h-48 bg-gray-200 flex items-center justify-center"><span class="text-gray-400">–ù–µ—Ç —Ñ–æ—Ç–æ</span></div>';
      
      const statusColors = {
        available: 'bg-green-100 text-green-800',
        reserved: 'bg-yellow-100 text-yellow-800',
        sold: 'bg-gray-100 text-gray-800'
      };
      
      const statusTexts = {
        available: '–î–æ—Å—Ç—É–ø–µ–Ω',
        reserved: '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω',
        sold: '–ü—Ä–æ–¥–∞–Ω'
      };
      
      div.innerHTML = `
        ${mediaHtml}
        <div class="p-4">
          <div class="flex justify-between items-start mb-2">
            <div>
              <h3 class="font-semibold text-lg">${pet.name || pet.breed}</h3>
              <p class="text-sm text-gray-500">${pet.breed}</p>
            </div>
            <span class="text-xs px-2 py-1 rounded-full ${statusColors[pet.status]}">
              ${statusTexts[pet.status]}
            </span>
          </div>
          <p class="text-sm text-gray-600 mb-1">
            ${pet.gender === 'male' ? '‚ôÇ –ú–∞–ª—å—á–∏–∫' : '‚ôÄ –î–µ–≤–æ—á–∫–∞'}, ${pet.age} –º–µ—Å.
          </p>
          <p class="text-lg font-bold text-blue-600 mb-3">${pet.price.toLocaleString()} ‚Ç¥</p>
          ${pet.views !== undefined ? `<p class="text-xs text-gray-500 mb-2">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: ${pet.views || 0}</p>` : ''}
          <div class="flex gap-2">
            <button onclick="editPet('${id}')" 
                    class="flex-1 bg-blue-100 text-blue-700 py-2 rounded hover:bg-blue-200 transition text-sm">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button onclick="deletePet('${id}')" 
                    class="flex-1 bg-red-100 text-red-700 py-2 rounded hover:bg-red-200 transition text-sm">
              –£–¥–∞–ª–∏—Ç—å
            </button>
          </div>
        </div>
      `;
      
      return div;
    }
    
    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
    window.editPet = async function(id) {
      currentEditingId = id;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∏—Ç–æ–º—Ü–∞
      const petRef = window.dbRef(window.database, `pets/${id}`);
      const snapshot = await window.dbGet(petRef);
      
      if (!snapshot.exists()) {
        showNotification('–ü–∏—Ç–æ–º–µ—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
      }
      
      const pet = snapshot.val();
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
      showTab('add');
      
      // –ú–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫—É
      document.getElementById('formTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞';
      document.getElementById('submitBtn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
      document.getElementById('cancelBtn').classList.remove('hidden');
      document.getElementById('editingPetId').value = id;
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
      document.getElementById('petName').value = pet.name || '';
      document.getElementById('petType').value = pet.type;
      document.getElementById('breed').value = pet.breed;
      document.getElementById('gender').value = pet.gender;
      document.getElementById('age').value = pet.age;
      document.getElementById('price').value = pet.price;
      document.getElementById('status').value = pet.status;
      document.getElementById('description').value = pet.description || '';
      document.getElementById('vaccinations').value = pet.vaccinations || '';
      document.getElementById('parents').value = pet.parents || '';
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ–¥–∏–∞
      existingMedia = pet.media || [];
      uploadedFiles = [];
      updatePreview();
    }
    
    // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.cancelEdit = function() {
      document.getElementById('petForm').reset();
      document.getElementById('formTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞';
      document.getElementById('submitBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞';
      document.getElementById('cancelBtn').classList.add('hidden');
      document.getElementById('editingPetId').value = '';
      uploadedFiles = [];
      existingMedia = [];
      currentEditingId = null;
      document.getElementById('mediaPreview').innerHTML = '';
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
    window.deletePet = async function(id) {
      if (!window.auth.currentUser) {
        alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è');
        return;
      }
      
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        try {
          // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∏—Ç–æ–º—Ü–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∞
          const petRef = window.dbRef(window.database, `pets/${id}`);
          const snapshot = await window.dbGet(petRef);
          
          if (snapshot.exists()) {
            const pet = snapshot.val();
            
            // –£–¥–∞–ª—è–µ–º –º–µ–¥–∏–∞ —Ñ–∞–π–ª—ã –∏–∑ Storage
            if (pet.media && pet.media.length > 0) {
              for (const media of pet.media) {
                try {
                  // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–∑ URL
                  const url = new URL(media.url);
                  const path = decodeURIComponent(url.pathname.split('/o/')[1].split('?')[0]);
                  const fileRef = window.storageRef(window.storage, path);
                  await window.deleteObject(fileRef);
                } catch (err) {
                  console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', err);
                }
              }
            }
          }
          
          // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
          await window.dbRemove(petRef);
          showNotification('–ü–∏—Ç–æ–º–µ—Ü —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
          showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–∏—Ç–æ–º—Ü–∞', 'error');
        }
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    window.loadStats = function() {
      const petsRef = window.dbRef(window.database, 'pets');
      window.dbOnValue(petsRef, (snapshot) => {
        const statsContent = document.getElementById('statsContent');
        statsContent.innerHTML = '';
        
        const pets = snapshot.val();
        if (!pets) {
          statsContent.innerHTML = '<p class="text-gray-500 text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
          return;
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
        const petsArray = Object.entries(pets).map(([id, pet]) => ({
          id,
          ...pet,
          views: pet.views || 0
        }));
        
        petsArray.sort((a, b) => b.views - a.views);
        
        // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const table = document.createElement('div');
        table.className = 'overflow-x-auto';
        table.innerHTML = `
          <table class="min-w-full bg-white">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ü–∏—Ç–æ–º–µ—Ü</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ü–æ—Ä–æ–¥–∞</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°—Ç–∞—Ç—É—Å</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              ${petsArray.map(pet => `
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">${pet.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${pet.breed}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                      ${pet.status === 'available' ? 'bg-green-100 text-green-800' : 
                        pet.status === 'reserved' ? 'bg-yellow-100 text-yellow-800' : 
                        'bg-gray-100 text-gray-800'}">
                      ${pet.status === 'available' ? '–î–æ—Å—Ç—É–ø–µ–Ω' : 
                        pet.status === 'reserved' ? '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω' : '–ü—Ä–æ–¥–∞–Ω'}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <div class="flex items-center">
                      <span class="mr-2">üëÅ</span>
                      <span class="font-medium">${pet.views}</span>
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        
        statsContent.appendChild(table);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const totalViews = petsArray.reduce((sum, pet) => sum + pet.views, 0);
        const avgViews = Math.round(totalViews / petsArray.length);
        
        const summary = document.createElement('div');
        summary.className = 'mt-6 grid grid-cols-3 gap-4';
        summary.innerHTML = `
          <div class="bg-blue-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">–í—Å–µ–≥–æ –ø–∏—Ç–æ–º—Ü–µ–≤</p>
            <p class="text-2xl font-bold text-blue-600">${petsArray.length}</p>
          </div>
          <div class="bg-green-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
            <p class="text-2xl font-bold text-green-600">${totalViews}</p>
          </div>
          <div class="bg-purple-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
            <p class="text-2xl font-bold text-purple-600">${avgViews}</p>
          </div>
        `;
        
        statsContent.appendChild(summary);
      });
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫
    window.loadCallbacks = function() {
      const callbacksRef = window.dbRef(window.database, 'callbacks');
      window.dbOnValue(callbacksRef, (snapshot) => {
        const callbacksContent = document.getElementById('callbacksContent');
        callbacksContent.innerHTML = '';
        
        const callbacks = snapshot.val();
        if (!callbacks) {
          callbacksContent.innerHTML = '<p class="text-gray-500 text-center">–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>';
          return;
        }
        
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ)
        const callbacksArray = Object.entries(callbacks).map(([id, callback]) => ({
          id,
          ...callback
        }));
        
        callbacksArray.sort((a, b) => b.createdAt - a.createdAt);
        
        // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞—è–≤–æ–∫
        const table = document.createElement('div');
        table.className = 'overflow-x-auto';
        table.innerHTML = `
          <table class="min-w-full bg-white">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ò–º—è</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–î–∞—Ç–∞</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°—Ç–∞—Ç—É—Å</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              ${callbacksArray.map(callback => {
                const date = new Date(callback.createdAt).toLocaleString('ru-RU');
                const statusColors = {
                  new: 'bg-yellow-100 text-yellow-800',
                  processed: 'bg-green-100 text-green-800',
                  cancelled: 'bg-red-100 text-red-800'
                };
                const statusTexts = {
                  new: '–ù–æ–≤–∞—è',
                  processed: '–û–±—Ä–∞–±–æ—Ç–∞–Ω–∞',
                  cancelled: '–û—Ç–º–µ–Ω–µ–Ω–∞'
                };
                const status = callback.status || 'new';
                
                return `
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap">${callback.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <a href="tel:${callback.phone}" class="text-blue-600 hover:underline">${callback.phone}</a>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColors[status]}">
                        ${statusTexts[status]}
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                      ${status === 'new' ? `
                        <button onclick="markCallbackAsProcessed('${callback.id}')" 
                                class="text-green-600 hover:text-green-900 mr-3">
                          ‚úì –û–±—Ä–∞–±–æ—Ç–∞–Ω–∞
                        </button>
                        <button onclick="markCallbackAsCancelled('${callback.id}')" 
                                class="text-red-600 hover:text-red-900">
                          ‚úó –û—Ç–º–µ–Ω–∏—Ç—å
                        </button>
                      ` : ''}
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        `;
        
        callbacksContent.appendChild(table);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–¥–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const newCount = callbacksArray.filter(c => c.status === 'new' || !c.status).length;
        const processedCount = callbacksArray.filter(c => c.status === 'processed').length;
        
        const summary = document.createElement('div');
        summary.className = 'mt-6 grid grid-cols-3 gap-4';
        summary.innerHTML = `
          <div class="bg-blue-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</p>
            <p class="text-2xl font-bold text-blue-600">${callbacksArray.length}</p>
          </div>
          <div class="bg-yellow-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">–ù–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫</p>
            <p class="text-2xl font-bold text-yellow-600">${newCount}</p>
          </div>
          <div class="bg-green-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</p>
            <p class="text-2xl font-bold text-green-600">${processedCount}</p>
          </div>
        `;
        
        callbacksContent.appendChild(summary);
      });
    }
    
    // –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞—è–≤–∫—É –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é
    window.markCallbackAsProcessed = async function(id) {
      const callbackRef = window.dbRef(window.database, `callbacks/${id}`);
      await window.dbUpdate(callbackRef, { status: 'processed' });
      showNotification('–ó–∞—è–≤–∫–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è');
    }
    
    // –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞—è–≤–∫—É –∫–∞–∫ –æ—Ç–º–µ–Ω–µ–Ω–Ω—É—é
    window.markCallbackAsCancelled = async function(id) {
      const callbackRef = window.dbRef(window.database, `callbacks/${id}`);
      await window.dbUpdate(callbackRef, { status: 'cancelled' });
      showNotification('–ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞');
    }
  </script>
</body>
</html>